[2025-06-25 23:34:55 WRN] Sensitive data logging is enabled. Log entries and exception messages may include sensitive application data; this mode should only be enabled during development.
[2025-06-25 23:34:56 INF] Executed DbCommand (35ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
[2025-06-25 23:34:56 INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
[2025-06-25 23:34:56 INF] Executed DbCommand (35ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
[2025-06-25 23:34:56 INF] Executed DbCommand (28ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
[2025-06-25 23:34:56 INF] Executed DbCommand (28ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
[2025-06-25 23:34:56 INF] Executed DbCommand (28ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
[2025-06-25 23:34:56 INF] Executed DbCommand (28ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
[2025-06-25 23:34:56 INF] Applying migration '20250625202121_InitialCreate'.
[2025-06-25 23:34:56 ERR] Failed executing DbCommand (62ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Activities] (
    [Id] int NOT NULL IDENTITY,
    [Title] nvarchar(max) NOT NULL,
    [Description] nvarchar(max) NOT NULL,
    [Category] nvarchar(max) NOT NULL,
    [Subcategory] nvarchar(max) NOT NULL,
    [Duration] int NOT NULL,
    [ContactInfo_Name] nvarchar(max) NULL,
    [ContactInfo_Email] nvarchar(max) NULL,
    [ContactInfo_Phone] nvarchar(max) NULL,
    [ContactInfo_Role] nvarchar(max) NULL,
    [Status] nvarchar(50) NOT NULL,
    [Rating] float NOT NULL,
    [Media_Videos] nvarchar(max) NULL,
    [CreatedAt] datetime2 NOT NULL,
    [UpdatedAt] datetime2 NOT NULL,
    [ContactInfoIsNull] bit NULL,
    [Categories] nvarchar(max) NOT NULL DEFAULT N'[]',
    [CountryCode] nvarchar(max) NOT NULL DEFAULT N'',
    [DestinationCode] nvarchar(max) NOT NULL DEFAULT N'',
    [DestinationName] nvarchar(max) NOT NULL DEFAULT N'',
    [Exclusions] nvarchar(max) NOT NULL,
    [Highlights] nvarchar(max) NULL,
    [ImportantInfo] nvarchar(max) NOT NULL DEFAULT N'[]',
    [Inclusions] nvarchar(max) NOT NULL DEFAULT N'[]',
    [IsActive] bit NOT NULL,
    [Itinerary] nvarchar(max) NULL,
    [TotalRatingCount] int NULL,
    [CoverImage] nvarchar(max) NULL,
    [GalleryImages] nvarchar(max) NULL,
    [PreviewImage] nvarchar(max) NULL,
    [ExclusionsJson] nvarchar(max) NOT NULL DEFAULT N'',
    [GuestFieldsJson] nvarchar(max) NOT NULL DEFAULT N'',
    [ImportantInfoJson] nvarchar(max) NOT NULL DEFAULT N'',
    [InclusionsJson] nvarchar(max) NOT NULL DEFAULT N'',
    [GuestFields] nvarchar(max) NOT NULL DEFAULT N'[]',
    [DetailsUrl] nvarchar(max) NULL DEFAULT N'',
    [PartnerSupplierId] nvarchar(max) NULL DEFAULT N'',
    [Label] nvarchar(max) NOT NULL DEFAULT N'',
    [IsFreeCancellation] bit NULL,
    CONSTRAINT [PK_Activities] PRIMARY KEY ([Id])
);
[2025-06-25 23:34:56 ERR] Veritabanı güncellenirken bir hata oluştu.
Microsoft.Data.SqlClient.SqlException (0x80131904): There is already an object named 'Activities' in the database.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlCommand.RunExecuteNonQueryTds(String methodName, Boolean isAsync, Int32 timeout, Boolean asyncWrite)
   at Microsoft.Data.SqlClient.SqlCommand.InternalExecuteNonQuery(TaskCompletionSource`1 completion, Boolean sendToPipe, Int32 timeout, Boolean& usedCache, Boolean asyncWrite, Boolean inRetry, String methodName)
   at Microsoft.Data.SqlClient.SqlCommand.ExecuteNonQuery()
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQuery(RelationalCommandParameterObject parameterObject)
   at Microsoft.EntityFrameworkCore.Migrations.MigrationCommand.ExecuteNonQuery(IRelationalConnection connection, IReadOnlyDictionary`2 parameterValues)
   at Microsoft.EntityFrameworkCore.Migrations.Internal.MigrationCommandExecutor.Execute(IReadOnlyList`1 migrationCommands, IRelationalConnection connection, MigrationExecutionState executionState, Boolean beginTransaction, Boolean commitTransaction, Nullable`1 isolationLevel)
   at Microsoft.EntityFrameworkCore.Migrations.Internal.MigrationCommandExecutor.<>c.<ExecuteNonQuery>b__3_1(DbContext _, ValueTuple`6 s)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.Execute[TState,TResult](TState state, Func`3 operation, Func`3 verifySucceeded)
   at Microsoft.EntityFrameworkCore.Migrations.Internal.MigrationCommandExecutor.ExecuteNonQuery(IReadOnlyList`1 migrationCommands, IRelationalConnection connection, MigrationExecutionState executionState, Boolean commitTransaction, Nullable`1 isolationLevel)
   at Microsoft.EntityFrameworkCore.Migrations.Internal.Migrator.MigrateImplementation(DbContext context, String targetMigration, MigrationExecutionState state, Boolean useTransaction)
   at Microsoft.EntityFrameworkCore.Migrations.Internal.Migrator.<>c.<Migrate>b__20_1(DbContext c, ValueTuple`4 s)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass28_0`2.<Execute>b__0(DbContext context, TState state)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementation[TState,TResult](Func`3 operation, Func`3 verifySucceeded, TState state)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.Execute[TState,TResult](TState state, Func`3 operation, Func`3 verifySucceeded)
   at Microsoft.EntityFrameworkCore.Migrations.Internal.Migrator.Migrate(String targetMigration)
   at Microsoft.EntityFrameworkCore.RelationalDatabaseFacadeExtensions.Migrate(DatabaseFacade databaseFacade)
   at Program.<Main>$(String[] args) in D:\TFS\Lymranet\Tourism\B2B\HotelWidget\TourManagement\Program.cs:line 78
ClientConnectionId:74fdb8ee-b6ea-415d-b6f9-3ecf070124c0
Error Number:2714,State:6,Class:16
[2025-06-25 23:34:56 INF] User profile is available. Using 'C:\Users\OZKAN\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
[2025-06-25 23:34:56 INF] Now listening on: http://localhost:5050
[2025-06-25 23:34:56 INF] Application started. Press Ctrl+C to shut down.
[2025-06-25 23:34:56 INF] Hosting environment: Development
[2025-06-25 23:34:56 INF] Content root path: D:\TFS\Lymranet\Tourism\B2B\HotelWidget\TourManagement
[2025-06-25 23:35:26 INF] Request starting HTTP/1.1 GET http://localhost:5050/ActivitiesWizard/CreateAvailability/32 - null null
[2025-06-25 23:35:26 INF] Executing endpoint 'TourManagementApi.Controllers.ActivitiesWizardController.CreateAvailability (TourManagementApi)'
[2025-06-25 23:35:26 INF] Route matched with {action = "CreateAvailability", controller = "ActivitiesWizard"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateAvailability(Int32) on controller TourManagementApi.Controllers.ActivitiesWizardController (TourManagementApi).
[2025-06-25 23:35:26 INF] Executing action method TourManagementApi.Controllers.ActivitiesWizardController.CreateAvailability (TourManagementApi) - Validation state: "Valid"
[2025-06-25 23:35:26 WRN] Compiling a query which loads related collections for more than one collection navigation, either via 'Include' or through projection, but no 'QuerySplittingBehavior' has been configured. By default, Entity Framework will use 'QuerySplittingBehavior.SingleQuery', which can potentially result in slow query performance. See https://go.microsoft.com/fwlink/?linkid=2134277 for more information. To identify the query that's triggering this warning call 'ConfigureWarnings(w => w.Throw(RelationalEventId.MultipleCollectionIncludeWarning))'.
[2025-06-25 23:35:26 INF] Executed DbCommand (59ms) [Parameters=[@__id_0='32'], CommandType='"Text"', CommandTimeout='30']
SELECT [a0].[Id], [a0].[Categories], [a0].[Category], [a0].[ContactInfo_Email], [a0].[ContactInfoIsNull], [a0].[ContactInfo_Name], [a0].[ContactInfo_Phone], [a0].[ContactInfo_Role], [a0].[CountryCode], [a0].[CoverImage], [a0].[CreatedAt], [a0].[Description], [a0].[DestinationCode], [a0].[DestinationName], [a0].[DetailsUrl], [a0].[Duration], [a0].[Exclusions], [a0].[ExclusionsJson], [a0].[GalleryImages], [a0].[GuestFields], [a0].[GuestFieldsJson], [a0].[Highlights], [a0].[ImportantInfo], [a0].[ImportantInfoJson], [a0].[Inclusions], [a0].[InclusionsJson], [a0].[IsActive], [a0].[IsFreeCancellation], [a0].[Itinerary], [a0].[Label], [a0].[Media_Videos], [a0].[PartnerSupplierId], [a0].[PreviewImage], [a0].[Rating], [a0].[Status], [a0].[Subcategory], [a0].[Title], [a0].[TotalRatingCount], [a0].[UpdatedAt], [s].[Id], [s].[ActivityId], [s].[CanBeBookedAfterStartTime], [s].[CutOff], [s].[Duration], [s].[EndTime], [s].[FromDate], [s].[Name], [s].[StartTime], [s].[UntilDate], [s].[Weekdays], [s].[Id0], [s].[Amount], [s].[Currency], [s].[MaxAge], [s].[MaxSeats], [s].[MinAge], [s].[MinSeats], [s].[Name0], [s].[OptionId], [s].[PriceType], [s].[Type]
FROM (
    SELECT TOP(1) [a].[Id], [a].[Categories], [a].[Category], [a].[ContactInfo_Email], [a].[ContactInfoIsNull], [a].[ContactInfo_Name], [a].[ContactInfo_Phone], [a].[ContactInfo_Role], [a].[CountryCode], [a].[CoverImage], [a].[CreatedAt], [a].[Description], [a].[DestinationCode], [a].[DestinationName], [a].[DetailsUrl], [a].[Duration], [a].[Exclusions], [a].[ExclusionsJson], [a].[GalleryImages], [a].[GuestFields], [a].[GuestFieldsJson], [a].[Highlights], [a].[ImportantInfo], [a].[ImportantInfoJson], [a].[Inclusions], [a].[InclusionsJson], [a].[IsActive], [a].[IsFreeCancellation], [a].[Itinerary], [a].[Label], [a].[Media_Videos], [a].[PartnerSupplierId], [a].[PreviewImage], [a].[Rating], [a].[Status], [a].[Subcategory], [a].[Title], [a].[TotalRatingCount], [a].[UpdatedAt]
    FROM [Activities] AS [a]
    WHERE [a].[Id] = @__id_0
) AS [a0]
LEFT JOIN (
    SELECT [o].[Id], [o].[ActivityId], [o].[CanBeBookedAfterStartTime], [o].[CutOff], [o].[Duration], [o].[EndTime], [o].[FromDate], [o].[Name], [o].[StartTime], [o].[UntilDate], [o].[Weekdays], [t].[Id] AS [Id0], [t].[Amount], [t].[Currency], [t].[MaxAge], [t].[MaxSeats], [t].[MinAge], [t].[MinSeats], [t].[Name] AS [Name0], [t].[OptionId], [t].[PriceType], [t].[Type]
    FROM [Options] AS [o]
    LEFT JOIN [TicketCategories] AS [t] ON [o].[Id] = [t].[OptionId]
) AS [s] ON [a0].[Id] = [s].[ActivityId]
ORDER BY [a0].[Id], [s].[Id]
[2025-06-25 23:35:26 INF] Executed action method TourManagementApi.Controllers.ActivitiesWizardController.CreateAvailability (TourManagementApi), returned result Microsoft.AspNetCore.Mvc.ViewResult in 462.8409ms.
[2025-06-25 23:35:28 INF] Executing ViewResult, running view CreateAvailability.
[2025-06-25 23:35:28 INF] Executed ViewResult - view CreateAvailability executed in 1838.8855ms.
[2025-06-25 23:35:28 INF] Executed action TourManagementApi.Controllers.ActivitiesWizardController.CreateAvailability (TourManagementApi) in 2372.0558ms
[2025-06-25 23:35:28 INF] Executed endpoint 'TourManagementApi.Controllers.ActivitiesWizardController.CreateAvailability (TourManagementApi)'
[2025-06-25 23:35:28 INF] Request finished HTTP/1.1 GET http://localhost:5050/ActivitiesWizard/CreateAvailability/32 - 200 null text/html; charset=utf-8 2571.4921ms
[2025-06-25 23:35:28 INF] Request starting HTTP/1.1 GET http://localhost:5050/_vs/browserLink - null null
[2025-06-25 23:35:28 INF] Request starting HTTP/1.1 GET http://localhost:5050/_framework/aspnetcore-browser-refresh.js - null null
[2025-06-25 23:35:28 INF] Request finished HTTP/1.1 GET http://localhost:5050/_framework/aspnetcore-browser-refresh.js - 200 13770 application/javascript; charset=utf-8 1.9536ms
[2025-06-25 23:35:28 INF] Request finished HTTP/1.1 GET http://localhost:5050/_vs/browserLink - 200 null text/javascript; charset=UTF-8 21.5114ms
