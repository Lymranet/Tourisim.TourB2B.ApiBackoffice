@model IEnumerable<TourManagementApi.Models.Activity>

@{
    ViewData["Title"] = "Activities";
}

<div class="container">
    <h2>Turlar</h2>
    <p>
        <a asp-action="Create" class="btn btn-primary">Yeni Tur Ekle</a>
    </p>
    <div class="table-responsive">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Başlık</th>
                    <th>Kategori</th>
                    <th>Durum</th>
                    <th>İşlemler</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td>@item.Title</td>
                        <td>@item.Category</td>
                        <td>
                            <select class="status-select btn btn-outline-secondary btn-sm" data-id="@item.Id" style="min-width: 100px;">
                                <option value="draft" selected="@(item.Status == "draft")">Taslak</option>
                                <option value="inactive" selected="@(item.Status == "inactive")">Pasif</option>
                                <option value="active" selected="@(item.Status == "active")">Aktif</option>
                            </select>
                        </td>
                        <td>
                            <a asp-action="Edit" asp-route-id="@item.Id" class="btn btn-sm btn-info">Düzenle</a>
                            <a class="btn btn-sm btn-secondary" href="@Url.Action("Index", "Options", new { activityId = item.Id })">Seçenekler</a>
                            <button class="btn btn-sm btn-danger" onclick="deleteActivity(@item.Id)">Sil</button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

@section Scripts {
    <script>
        function deleteActivity(id) {
            if (confirm('Bu turu silmek istediğinize emin misiniz?')) {
                fetch(`/api/ActivitiesApi/${id}`, {
                    method: 'DELETE',
                })
                .then(response => {
                    if (response.ok) {
                        window.location.reload();
                    } else {
                        alert('Tur silinirken bir hata oluştu');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Tur silinirken bir hata oluştu');
                });
            }
        }

        $('.status-select').on('change', function() {
            var id = $(this).data('id');
            var status = $(this).val();
            $.ajax({
                url: '/Activities/UpdateStatus',
                method: 'POST',
                data: { id: id, status: status },
                success: function(res) {
                    // Başarılıysa bir şey yapmaya gerek yok
                },
                error: function() {
                    alert('Durum güncellenemedi!');
                }
            });
        });
    </script>
} 