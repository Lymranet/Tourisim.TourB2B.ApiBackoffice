@model TourManagementApi.Models.Activity

@{
    ViewData["Title"] = "Create Activity";
}

<div class="container">
    <h2>Create Activity</h2>
    
    <!-- Progress bar -->
    <div class="progress mb-4">
        <div class="progress-bar" role="progressbar" style="width: 50%;" 
             aria-valuenow="50" aria-valuemin="0" aria-valuemax="100">Adım 1 / 2</div>
    </div>

    <!-- Steps indicator -->
    <div class="steps-indicator mb-4">
        <div class="step active" data-step="1">Temel Bilgi</div>
        <div class="step" data-step="2">Lokasyon & İletişim</div>
    </div>

    <form id="createForm" class="mt-4">
        <!-- Step 1: Basic Information -->
        <div class="form-step" id="step1" style="display: block;">
            <h4>Temel Bilgi</h4>
            <div class="form-group">
                <label for="title">Title</label>
                <input type="text" class="form-control" id="title" name="title" required>
                <div class="invalid-feedback">Please enter a title.</div>
            </div>

            <div class="form-group">
                <label for="category">Category</label>
                <select class="form-control" id="category" name="category" required onchange="updateSubcategories()">
                    <option value="">Select a category</option>
                    <option value="Adventure">Adventure</option>
                    <option value="Cultural">Cultural</option>
                    <option value="Nature">Nature</option>
                    <option value="Sports">Sports</option>
                    <option value="Food">Food & Drink</option>
                    <option value="Wellness">Wellness</option>
                </select>
                <div class="invalid-feedback">Please select a category.</div>
            </div>

            <div class="form-group">
                <label for="subcategory">Subcategory</label>
                <select class="form-control" id="subcategory" name="subcategory" required>
                    <option value="">First select a category</option>
                </select>
                <div class="invalid-feedback">Please select a subcategory.</div>
            </div>

            <div class="form-group">
                <label for="description">Description</label>
                <textarea class="form-control" id="description" name="description" rows="3" required></textarea>
                <div class="invalid-feedback">Please enter a description.</div>
            </div>

            <!-- Languages -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Available Languages</h5>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <div id="languages">
                            <div class="input-group mb-2">
                                <select class="form-control language-select" name="languages[]" required>
                                    <option value="">Select a language</option>
                                    <option value="tr">Türkçe</option>
                                    <option value="en">English</option>
                                    <option value="de">Deutsch</option>
                                    <option value="fr">Français</option>
                                    <option value="es">Español</option>
                                    <option value="it">Italiano</option>
                                    <option value="ru">Русский</option>
                                    <option value="ar">العربية</option>
                                </select>
                                <button type="button" class="btn btn-danger remove-language">Remove</button>
                            </div>
                        </div>
                        <button type="button" class="btn btn-primary mt-2" onclick="addLanguage()">Add Language</button>
                    </div>
                </div>
            </div>

            <!-- Contact Information -->
            <h5 class="mt-4">Contact Information</h5>
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="contactName">Contact Name</label>
                        <input type="text" class="form-control" id="contactName" name="contactInfo.name" required>
                        <div class="invalid-feedback">Please enter a contact name.</div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="contactRole">Role</label>
                        <select class="form-control" id="contactRole" name="contactInfo.role" required>
                            <option value="">Select a role</option>
                            <option value="guide">Guide</option>
                            <option value="tourOperator">Tour Operator</option>
                            <option value="manager">Manager</option>
                            <option value="coordinator">Tour Coordinator</option>
                            <option value="assistant">Tour Assistant</option>
                        </select>
                        <div class="invalid-feedback">Please select a role.</div>
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="contactEmail">Email</label>
                        <input type="email" class="form-control" id="contactEmail" name="contactInfo.email" required>
                        <div class="invalid-feedback">Please enter a valid email address.</div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="contactPhone">Phone</label>
                        <input type="tel" class="form-control" id="contactPhone" name="contactInfo.phone" required>
                        <div class="invalid-feedback">Please enter a valid phone number (minimum 10 digits).</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 2: Location & Contact -->
        <div class="form-step" id="step2" style="display: none;">
            <h4>Lokasyon & İletişim</h4>
            
            <!-- Location -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Activity Location</h5>
                </div>
                <div class="card-body">
                    <div class="form-group mb-3">
                        <label for="locationSearch">Search Address</label>
                        <div class="input-group">
                            <input type="text" class="form-control" id="locationSearch" placeholder="Enter address to search...">
                            <button type="button" class="btn btn-primary" onclick="searchLocation()">Search</button>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <div id="locationMap" style="height: 300px;" class="mb-3"></div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group">
                                <label for="address">Address</label>
                                <input type="text" class="form-control" id="address" name="location.address" required>
                                <div class="invalid-feedback">Please enter an address.</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="city">City</label>
                                <input type="text" class="form-control" id="city" name="location.city" required>
                                <div class="invalid-feedback">Please enter a city.</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="country">Country</label>
                                <input type="text" class="form-control" id="country" name="location.country" required>
                                <div class="invalid-feedback">Please enter a country.</div>
                            </div>
                        </div>
                    </div>
                    <input type="hidden" id="latitude" name="location.latitude">
                    <input type="hidden" id="longitude" name="location.longitude">
                </div>
            </div>
        </div>

        <!-- Navigation buttons -->
        <div class="form-navigation mt-4">
            <button type="button" class="btn btn-secondary" id="prevBtn" style="display: none;">Previous</button>
            <button type="button" class="btn btn-primary" id="nextBtn">Next</button>
            <button type="submit" class="btn btn-success" id="submitBtn" style="display: none;">Create Activity</button>
            <a asp-action="Index" class="btn btn-link">Back to List</a>
        </div>
    </form>
</div>

@section Styles {
    <style>
        .steps-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2rem;
        }

        .step {
            flex: 1;
            text-align: center;
            padding: 0.5rem;
            border-bottom: 3px solid #ddd;
            color: #666;
        }

        .step.active {
            border-bottom-color: #007bff;
            color: #007bff;
            font-weight: bold;
        }

        .form-step {
            display: none;
        }

        .form-step.active {
            display: block;
        }

        .form-navigation {
            display: flex;
            gap: 1rem;
            align-items: center;
        }
    </style>
}

@section Scripts {
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
        const defaultLocation = {
            lat: 41.0082,
            lng: 28.9784
        };
    </script>
    <script src="~/js/activity-form.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize step navigation
            initStepNavigation();
            
            // Initialize maps when steps are shown
            document.getElementById('step2Link').addEventListener('click', function() {
                setTimeout(initLocationMap, 100);
            });
            
            document.getElementById('step5Link').addEventListener('click', function() {
                setTimeout(initMeetingPointMap, 100);
            });
            
            // Initialize first step's map
            if (document.getElementById('step2').style.display !== 'none') {
                setTimeout(initLocationMap, 100);
            }
        });
    </script>
}